<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analyzing results • shinyloadtest</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Analyzing results">
<meta property="og:description" content="shinyloadtest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">shinyloadtest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/shinycannon.html">Installing and running shinycannon</a>
    </li>
    <li>
      <a href="../articles/analyzing-load-test-logs.html">Analyzing results</a>
    </li>
    <li>
      <a href="../articles/case-study-scaling.html">Case study: Scaling an app</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Advanced</li>
    <li>
      <a href="../articles/limitations-of-shinyloadtest.html">Limitations of shinyloadtest</a>
    </li>
    <li>
      <a href="../articles/load-testing-authenticated-apps.html">Load Testing Authenticated Apps</a>
    </li>
    <li>
      <a href="../articles/troubleshooting-ssl.html">Troubleshooting SSL</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/shinyloadtest/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="analyzing-load-test-logs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Analyzing results</h1>
            
            <h4 data-toc-skip class="date">2018-09-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/shinyloadtest/blob/HEAD/vignettes/analyzing-load-test-logs.Rmd" class="external-link"><code>vignettes/analyzing-load-test-logs.Rmd</code></a></small>
      <div class="hidden name"><code>analyzing-load-test-logs.Rmd</code></div>

    </div>

    
    
<p>This vignette shows you how to analyse the results of your load tests, explaining the plots produced in the report, and giving a few tips on interpretation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/shinyloadtest/">shinyloadtest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h2>
<p>Start by loading the <code>shinycannon</code> results into R with <code><a href="../reference/load_runs.html">load_runs()</a></code>. If you have a single run, just give it the directory of the results:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_runs.html">load_runs</a></span><span class="op">(</span><span class="st">"test_sessions/demo1"</span><span class="op">)</span></span></code></pre></div>
<p>If you have multiple runs, give it multiple directories, optionally providing informative labels. Here I’m loading three runs that replay the same script simulating 1, 4, and 16 simultaneous uses:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_runs.html">load_runs</a></span><span class="op">(</span></span>
<span>  `1 user` <span class="op">=</span> <span class="st">"test_sessions/demo1"</span>,</span>
<span>  `4 users` <span class="op">=</span> <span class="st">"test_sessions/demo4"</span>,</span>
<span>  `16 users` <span class="op">=</span> <span class="st">"test_sessions/demo16"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/load_runs.html">load_runs()</a></code> returns a tidy tibble:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11,729 × 13</span></span></span>
<span><span class="co">#&gt;    run    user_id session_id iteration input…¹ event start   end    time concu…²</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1 user       0          0         0       1 REQ_… 0     0.308 0.308         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1 user       0          0         0       2 REQ_… 0.309 0.316 0.007<span style="text-decoration: underline;">00</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1 user       0          0         0       3 REQ_… 0.316 0.323 0.007<span style="text-decoration: underline;">00</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1 user       0          0         0       4 REQ_… 0.323 0.33  0.007<span style="text-decoration: underline;">00</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1 user       0          0         0       5 REQ_… 0.33  0.339 0.009<span style="text-decoration: underline;">00</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1 user       0          0         0       6 REQ_… 0.339 0.351 0.012<span style="text-decoration: underline;">0</span>        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1 user       0          0         0       7 REQ_… 0.351 0.361 0.010<span style="text-decoration: underline;">0</span>        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1 user       0          0         0       8 REQ_… 0.361 0.365 0.004<span style="text-decoration: underline;">00</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1 user       0          0         0       9 REQ_… 0.366 0.373 0.007<span style="text-decoration: underline;">00</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1 user       0          0         0      10 REQ_… 0.373 0.382 0.009<span style="text-decoration: underline;">00</span>       0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 11,719 more rows, 3 more variables: maintenance &lt;lgl&gt;, label &lt;ord&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   json &lt;list&gt;, and abbreviated variable names ¹​input_line_number,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ²​concurrency</span></span></span></code></pre></div>
<p>The first three variables identify each simulated session:</p>
<ul>
<li>
<code>run</code> labels each shinycannon run.</li>
<li>
<code>user_id</code> labels each simulated user (shinycannon worker) within a run.</li>
<li>
<code>session_id</code> uniquely identifies each simulated session (script replay) within a run.</li>
</ul>
<p><code><a href="../reference/load_runs.html">?load_runs</a></code> provides a full description of all the variables.</p>
</div>
<div class="section level2">
<h2 id="report-output">Report output<a class="anchor" aria-label="anchor" href="#report-output"></a>
</h2>
<p>You won’t generally work with this data directly — instead, you’ll usually start by creating a standalone HTML report:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/shinyloadtest_report.html">shinyloadtest_report</a></span><span class="op">(</span><span class="va">df</span>, <span class="st">"report.html"</span><span class="op">)</span></span></code></pre></div>
<p>This report contains six pages of diagnostic information: sessions, session duration, event waterfall, latency, event duration, and event concurrency. I describe each page below.</p>
</div>
<div class="section level2">
<h2 id="sessions">Sessions<a class="anchor" aria-label="anchor" href="#sessions"></a>
</h2>
<p>The <strong>Sessions</strong> page displays the summarises the simulated sessions performed by each shinycannon worker. Each row represent one worker and each rectangle represents one event. The width of the rectangle gives the duration of the event, and the colour gives the event type. For example, the following plot shows the actions performed by 4 workers over 5 minutes (600s):</p>
<p><img src="analyzing-load-test-logs_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<p>If you use more workers, you’ll see more rows. The following plot shows the results from 16 simultaneous workers:</p>
<p><img src="analyzing-load-test-logs_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
<p>The first thing to look for in this plot is the balance between the user waiting for the app (coloured rectangles) and the app waiting for the user (gray background shows through). The more brightly coloured the plot, the more time that the user spends waiting. The precise colour of the block is also informative, as there are five types of action that proceed in roughly the same order in every session:</p>
<ul>
<li><p>Homepage (red): the browser first loads the HTML homepage generated by your <code>ui</code>, representing the start of a new simulated session. If the first session takes a long time to load, you’re probably doing too much work on start up (but you’ll have also noticed this when starting the app yourself). If subsequent sessions take a long time, you probably have a <code>ui()</code> function that is doing too much work.</p></li>
<li><p>JS/CSS (orange): once the browser has read the homepage, it next requests the <code>.css</code> and <code>.js</code> files needed to render the page. It is very rare for these to take a long time, and typically if they do it’s because the server is “blocked” waiting for computation requested by another worker.</p></li>
<li><p>Start session (green): now the browser creates a bi-direction line of communication to the Shiny session using <a href="http://sockjs.org" class="external-link">SockJS</a>. The browser uses this to notify Shiny when the user interacts with an input, and Shiny uses it to tell the browser how to update the outputs.</p></li>
<li><p>Calculate (blue): the user has changed an input and Shiny has performed computation to update an output or execute an observer.</p></li>
<li><p>Waiting (uncoloured): the app is waiting for input; i.e. the user is thinking about what to do next.</p></li>
</ul>
<p>Also note the dotted vertical lines. These show the three major phases of the load test:</p>
<ul>
<li><p>Before the first dotted line, we have the <strong>warmup</strong> phase, where shinycannon gradually ramps up to the desired number of workers.</p></li>
<li><p>Next we have the <strong>maintenance</strong> phase, where the number of sessions is held constant; whenever one replay completes, shinycannon restarts the script.</p></li>
<li><p>Finally, after the second dotted line, we have the <strong>cooldown</strong> phase where the workers are shut down one at a time, until none are left the run is complete..</p></li>
</ul>
<p>The rest of the report will focus on sessions in the maintenance phase since these represent an app under the full load of simultaneous users. If the maintenance period is a only a small proportion of the full app, you’ll need to re-run the simulation with a greater <code>--loaded-duration-minutes</code> value.</p>
<p>The sessions tab gives you an overview of the experimental design (how sessions were assigned to workers), so you’ll generally only spend a small amount of time on this page before moving on to the <strong>session duration</strong>.</p>
</div>
<div class="section level2">
<h2 id="session-duration">Session duration<a class="anchor" aria-label="anchor" href="#session-duration"></a>
</h2>
<p>The <strong>Session duration</strong> page uses similar graphical conventions to the <strong>Session</strong> page but instead of one worker per row, we now have one session per row, and the time on the x-axis is relative to session start. A red line shows the running time of the original script.</p>
<p><img src="analyzing-load-test-logs_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
<p>This plot shows us that most sessions are completed in about the same amount of time as the original script, which suggests that the app can comfortably handle four simultaneous users. We get a very different picture if we look at the performance of the app with 16 simultaneous users:</p>
<p><img src="analyzing-load-test-logs_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
<p>The fastest session now takes ~4 times longer than the original recording, and there’s one session that takes twice again as long again. This suggests that we’ve overloaded the server and we either need to increase server resources or optimise the app.</p>
</div>
<div class="section level2">
<h2 id="event-waterfall">Event waterfall<a class="anchor" aria-label="anchor" href="#event-waterfall"></a>
</h2>
<p>The <strong>Event Waterfall</strong> gives a more precise view into the individual events within a recording. Each line represents a session, with events running from top to bottom, and elapsed time on the x-axis.</p>
<p><img src="analyzing-load-test-logs_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
<p>In this plot you’re primarily looking for uniform shape. In particular, you want the lines to be parallel, because a crossing line indicates that user A started before user B, but finished afterwards (this is like seeing the table that ordered after you get their food first). We can see this problem in different run, where a file was uploaded and many POST requests were made.</p>
<p><img src="analyzing-load-test-logs_files/figure-html/unnamed-chunk-11-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="latency">Latency<a class="anchor" aria-label="anchor" href="#latency"></a>
</h2>
<p>The <strong>Latency</strong> page summarises the amount of time spent waiting, broken down in to total HTTP (homepage + js/css) and websockets (representing calculation). The <strong>Total HTTP</strong> latency plot shows how long a user has to wait before they see <em>something</em> in their browser. Ideally, this will be very short since the server is just providing static files.</p>
<p><img src="analyzing-load-test-logs_files/figure-html/unnamed-chunk-12-1.png" width="100%"></p>
<p>The variability is because R is single threaded; if Shiny is performing a computation for another worker, it can’t launch the transmission of static files.</p>
<p>The <strong>Maximum WebSocket</strong> latency shows how much time time a user spends waiting for outputs to be updated. This basically represents how much time R spends computing. To make this faster, you’ll need to make your R code faster.</p>
<p><img src="analyzing-load-test-logs_files/figure-html/unnamed-chunk-13-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="event-duration">Event duration<a class="anchor" aria-label="anchor" href="#event-duration"></a>
</h2>
<p>The <strong>Event Duration</strong> page helps understand the variability of individual events. Each event is summarised with a boxplot, with run on the x-axis and time on the y-axis:</p>
<p><img src="analyzing-load-test-logs_files/figure-html/unnamed-chunk-14-1.png" width="100%"></p>
<p>Since there are typically many events, and most are uninteresting, the report gives you three ways to find interesting events:</p>
<ul>
<li>Slowest maximum time.</li>
<li>Slowest minimum time.</li>
<li>Largest mean difference (only shown if more than one run being processed).</li>
</ul>
<p>These plots can help you find events that are either slow, or have high variability. You’ll then need to backtrack to the underlying Shiny code and think about how to improve performance.</p>
</div>
<div class="section level2">
<h2 id="event-concurrency">Event concurrency<a class="anchor" aria-label="anchor" href="#event-concurrency"></a>
</h2>
<p>The <strong>Event Concurrency</strong> page helps you understand how events responded to varying degrees of concurrent load. Each simulated session is represented by a point with number of concurrent processes on the x-axis and time taken on the y-axis. The points are coloured by run. Each run also gets a line of best fit, which gives a sense for how the event respond to increasing concurrency.</p>
<p><img src="analyzing-load-test-logs_files/figure-html/unnamed-chunk-15-1.png" width="100%"></p>
<p>Like <strong>Event Duration</strong>, most events are uninteresting, so the report gives you three ways of sorting to find interesting events:</p>
<ul>
<li>Largest slope, which emphasises events that appear to respond particularly poorly to increasing concurrency.</li>
<li>Largest intercept</li>
<li>Largest error</li>
</ul>
<p>If you want your app to handle as many user as possible, look for events where the time increases steeply with concurrency - these are places where optimisation will have the greatest impact.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Barret Schloerke, Alan Dipert, Barbara Borges, RStudio.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '993bbaa8141e65ce07013c0f54fc3277',
    indexName: 'shinyloadtest',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
